<div class="panel panel-default seat-show">
  <div class="row">
      <div class="panel-body">
        <div class="schedule">
            <span style="font-size: small; color: grey"> Scheduled </span>
            <span><%= @seat.journey.departure.strftime('%B %d, %Y') %></span>
        </div>
        <div class="row">      
          <div class="col-md-3 journey-header-from">
            <div class="table-responsive">
              <h4 >
               <span class="location-from">
                  <svg viewBox="0 0 12 12">
                    <path d="M6 5.7c.4 0 .7-.1.9-.4.3-.3.4-.6.4-.9 0-.4-.1-.7-.4-.9-.2-.3-.5-.4-.9-.4s-.7.1-.9.4c-.3.2-.4.5-.4.9s.1.7.4.9c.2.3.5.4.9.4zm0-5c1 0 1.9.4 2.6 1.1.7.7 1.1 1.6 1.1 2.6 0 .5-.1 1.1-.4 1.8s-.5 1.3-.9 1.9c-.4.5-.7 1.1-1.1 1.6-.4.5-.7.9-.9 1.2l-.4.4c-.1-.1-.2-.3-.4-.5s-.5-.6-.9-1.2c-.4-.5-.8-1-1.1-1.6s-.7-1.1-.9-1.8c-.3-.7-.4-1.3-.4-1.8 0-1 .4-1.9 1.1-2.6S5 .7 6 .7z">
                   </path>
                  </svg> 
                </span>
                <span> <%=  @seat.journey.from.name  %>  </span>   
              </h4>  
              <span>
                Departure time
              </span>
              <span style="font-size: larger;">
                <%= @seat.journey.departure.time.strftime(' %H:%M') %>
              </span>
            </div>  
          </div>
          <div class="col-md-3">
            <div class="row">
              <div class="duration">
                <%= Time.at(@seat.journey.arrival - @seat.journey.departure).utc.strftime("%H h %M m") %> 
              </div>
            </div>
            <div class="row">
              <div class="col-md-2">
                <div class="circle-left">
                </div>
              </div>
              <div class="col-md-6 line"></div>
              <div class="col-md-2">
                 <div class="circle-right">
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3">
                <h4>
                  <span class="location-to">
                    <svg viewBox="0 0 12 12">
                      <path d="M6 5.7c.4 0 .7-.1.9-.4.3-.3.4-.6.4-.9 0-.4-.1-.7-.4-.9-.2-.3-.5-.4-.9-.4s-.7.1-.9.4c-.3.2-.4.5-.4.9s.1.7.4.9c.2.3.5.4.9.4zm0-5c1 0 1.9.4 2.6 1.1.7.7 1.1 1.6 1.1 2.6 0 .5-.1 1.1-.4 1.8s-.5 1.3-.9 1.9c-.4.5-.7 1.1-1.1 1.6-.4.5-.7.9-.9 1.2l-.4.4c-.1-.1-.2-.3-.4-.5s-.5-.6-.9-1.2c-.4-.5-.8-1-1.1-1.6s-.7-1.1-.9-1.8c-.3-.7-.4-1.3-.4-1.8 0-1 .4-1.9 1.1-2.6S5 .7 6 .7z">
                     </path>
                    </svg> 
                  </span>
                  <span"><%= @seat.journey.to.name  %>  </span>   
                </h4>
       
            <span>
              Estimated Arrival time
            </span>
            <span style="font-size: larger;">
              <%= @seat.journey.arrival.time.strftime(' %H:%M') %>
            </span>

          </div> 
         <div class="col-md-3 ">
            <h2>
              K<%= @seat.journey.price %>
            </h2>
          </div>   
        </div>
      </div>
  </div>
</div>

<div class="panel">
  <div class="bus-header">
    <h3>Select A Bus Seat: <i class="fa fa-bus" aria-hidden="true"></i></h3>
    <span style="font-size: large;">Key:</span>
    <span id="occupied">&nbsp;&nbsp;&nbsp;&nbsp;</span> Occupied
    <span id="unoccupied">&nbsp;&nbsp;&nbsp;&nbsp;</span> Unoccupied
    <span id="selected">&nbsp;&nbsp;&nbsp;&nbsp;</span> Selected
  </div>
  <% unless @seat.journey.seats.blank? %>
    <div class="row">
      <div class="col-md-6">
        <div class="wheels"></div>
      </div>
      <div class="col-md-6">
        <div class="wheels"></div>
      </div>
    </div>  
    <div class="row bus">
      <% @empty_seats.each do |seat| %>
        <% if (seat.seat_number == 6 || seat.seat_number == 17) && !seat.occupied  %>
          <div class="col-md-1 blank">
          </div>

          <div class="col-md-1">
           <% if seat.seat_number == @seat.seat_number %>
            	<span> <%= link_to seat.seat_number,'',  class: "btn btn-default btn-selected" %></span>
            <% else %>
            	  <span> <%= link_to seat.seat_number,seat,  class: "btn btn-default btn-danger" %></span>
            	<% end %>
          </div>
        <% else%>
          <% if (seat.seat_number == 23)%>
              <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>
                <div class="col-md-1 blank">
              </div>         
          <% end %>

          	<% if seat.id == @seat.id %>
            <div class="col-md-1 ">               
              <span> <%= link_to seat.seat_number, '',  class: "btn btn-default btn-selected"%></span>
            </div>
          	
          	<% else %>
              <% if seat.purchases.blank? %>
  	            <div class="col-md-1 ">               
  	              <span> <%= link_to seat.seat_number, seat,  class: "btn btn-default btn-danger"%></span>
  	            </div>
              <% else %>
                <div class="col-md-1 ">               
                  <span> <%= link_to seat.seat_number, '',  class: "btn btn-default btn-success"%></span>
                </div>               
              <% end %>
            <% end %>
        <% end %>
      <% end %>
    </div>     
  <% end %>
 
  <div class="row">
    <div class="col-md-6">
      <div class="wheels-bottom"></div>
    </div>
    <div class="col-md-6">
      <div class="wheels-bottom"></div>
    </div>
  </div>
</div>

<div class="row panel">

	<div class="col-md-6">
		<h4> You have Selected Seat : <%= @seat.seat_number %></h4>
	</div>
	<div class="col-md-6 continue">
		<h4>   
      <%= form_tag charges_path, id:'chargeForm' do %>
        <article>
          <% if flash[:error].present? %>
            <div id="error_explanation">
              <p><%= flash[:error] %></p>
            </div>
          <% end %>
          <script src="https://checkout.stripe.com/checkout.js"></script>
            <%= hidden_field_tag 'stripeToken' %>
            <%= hidden_field_tag 'amount', (@seat.journey.price * 100).to_i %>
            <%= hidden_field_tag 'stripeEmail' %>
            <%= hidden_field_tag 'seat_id', @seat.id %>
        
            <button id="btn-buy" type="button" class="btn btn-purchase btn-lg btn-block"><span class="glyphicon"></span> Continue</button>
          </article>

          <script>
            var handler = StripeCheckout.configure({
              key: '<%= Rails.configuration.stripe[:publishable_key] %>',
              address: true,
              token: function(token, arg) {
                document.getElementById("stripeToken").value = token.id;
                document.getElementById("stripeEmail").value = token.email;
                document.getElementById("chargeForm").submit();
              }
            });

            document.getElementById('btn-buy').addEventListener('click', function(e) {
              handler.open({
                name: 'checkout',
                description: '<%= @seat.journey.to %> (k<%= @seat.journey.price %>)',
                amount: document.getElementById("amount").value
            });
            e.preventDefault();
           })
          </script>
      <% end %>  
    </h4>
	</div>
</div>







